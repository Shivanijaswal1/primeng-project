<div class="p-fluid">
    <p-splitter [panelSizes]="panelSize" [minSizes]="minSize" styleClass="mb-5">
        <ng-template pTemplate>
            <form [formGroup]="form" (ngSubmit)="onSubmit()">
                <div class="form-tab-header">
          <div
            *ngFor="let tab of formTabs; let i=index"
            class="form-tab"
            [ngClass]="{ 'active-tab': activeTabIndex === i }"
            (click)="scrollToSection(tab.sectionId,i)">
            {{ tab.label }}
              </div>
            </div>
                <div id="content" #content>
                      <div class="section section-one">
                    <h3>Personal Information</h3>
                    <div class="form-css">
                        <label for="name">
                            Name <span *ngIf="form.get('name')?.errors && form.get('name')?.touched"
                                style="color: red;">*</span>
                        </label>
                        <app-input formControlName="name" name="name" [message]="message"
                            [required]="true" type="text"
                            pattern="^[A-Za-z]+\s?[A-Za-z]+$"
                            [ngClass]="{'invalid-field': form.get('name')?.invalid && form.get('name')?.touched}"></app-input>
                        <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched"
                            class="error-text" style="color: red;">
                            Name is required and should contain only letters.
                        </div>
                    </div>
                    <div class="form-css-inline">
                        <div class="form-css-half">
                            <label for="parentDropdown">Choose Parent</label>
                            <!-- <p-dropdown
                                formControlName="parent"
                                name="parent"
                                inputId="parentDropdown"
                                [options]="parentOptions"
                                optionLabel="value"
                                optionValue="key"
                                placeholder="Select Parent"
                                [required]="true"
                                (onChange)="onParentChange($event)"
                                [ngClass]="{'invalid-field': form.get('parent')?.invalid && form.get('parent')?.touched}">
                                <ng-template let-option pTemplate="item">
                                    <div [pTooltip]="option.value"
                                        tooltipPosition="right">
                                        {{ option.value }}
                                    </div>
                                </ng-template>
                            </p-dropdown> -->
                    <!-- <p-autoComplete
                        #parentAutoComplete
                        formControlName="parent"
                        [suggestions]="filteredParents"
                        [field]="'value'"
                        [dropdown]="true"
                        [forceSelection]="true"
                        (completeMethod)="filterParents($event)"
                        (onFocus)="openParentSuggestions()"
                        (onSelect)="onParentSelect($event)"
                        [ngClass]="{'invalid-field': form.get('parent')?.invalid && form.get('parent')?.touched}">
                  </p-autoComplete> -->
         <p-multiSelect
              #parentMultiSelect
              formControlName="parent"
              [options]="filteredParents"
              optionLabel="value"
              defaultLabel="Select Parent"
              [showToggleAll]="false"
              [filter]="true"
              [showHeader]="false"
              (onFocus)="parentMultiSelect.show()"
              (onChange)="onParentSelect($event)"
              [ngClass]="{
             'invalid-field': form.get('parent')?.invalid && form.get('parent')?.touched
              }">
        </p-multiSelect>
                        </div>
                        <div class="form-css-half">
                            <ng-container>
                                <label for="childDropdown">Choose Child</label>
                                <p-dropdown
                                    #dropdownElem
                                    formControlName="child"
                                    name="children"
                                    inputId="childDropdown"
                                    [options]="childOptions"
                                    optionLabel="value"
                                    optionValue="key"
                                    [editable]="isEditable"
                                    placeholder="Select Child"
                                    (onChange)="onDropdownChange($event)"
                                    (onBlur)="onDropdownBlur()"
                                    [ngClass]="{'invalid-field': form.get('child')?.invalid && form.get('child')?.touched}">
                                    <ng-template pTemplate="footer">
                                        <div class="p-3"
                                            *ngIf="form.get('parent')?.value">
                                            <app-z-button
                                                label="Add New"
                                                icon="pi pi-plus"
                                                severity="secondary"
                                                size="small"
                                                class="footer-button"
                                                (handleclick)="DropdownEditable()" />
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                                <div
                                    *ngIf="form.get('child')?.invalid && form.get('child')?.touched"
                                    class="error-text" style="color: red;">
                                    Child selection is required
                                </div>
                                <div *ngIf="childExistsError"
                                    style="color: red; font-size: 13px;">
                                    This value already exists in the dropdown.
                                </div>
                            </ng-container>
                        </div>
                    </div>
                    </div>
                          <div class="section section-two">
                             <h3>Contact Details</h3>
                    <div class="box1">
                        <div class="form-css5">
                            <label for="email">
                                Email <span *ngIf="form.get('email')?.errors && form.get('email')?.touched"
                                    style="color: red;">*</span>
                            </label>
                            <app-input formControlName="email" name="email"
                                [required]="true"
                                type="email"
                                [ngClass]="{'invalid-field': form.get('email')?.invalid && form.get('email')?.touched}"></app-input>
                            <div *ngIf="form.get('email')?.invalid && form.get('email')?.touched"
                                class="error-text" style="color: red;">
                                Please enter a valid email address.
                            </div>
                        </div>
                    </div>
                    <div class="form-css4">
                        <label for="fathername">
                            Fathername/Guardian <span *ngIf="form.get('father')?.errors && form.get('father')?.touched"
                                style="color: red;">*</span>
                        </label>
                        <app-input formControlName="father"
                            name="father" pattern="^[A-Za-z]+\s?[A-Za-z]+$"
                            [required]="true" type="text"
                            [ngClass]="{'invalid-field': form.get('father')?.invalid && form.get('father')?.touched}"></app-input>
                        <div *ngIf="form.get('father')?.invalid && form.get('father')?.touched"
                            class="error-text" style="color: red;">
                            Father Name is required and should contain only
                            letters.
                        </div>
                    </div>
                    <div class="address-group">
                        <div class="form-css">
                            <label for="address">
                                Address <span *ngIf="form.get('address')?.errors && form.get('address')?.touched"
                                    style="color: red;">*</span>
                            </label>
                            <app-input formControlName="address" name="address"
                                type="text" [required]="true"
                                [ngClass]="{'invalid-field': form.get('address')?.invalid && form.get('address')?.touched}"></app-input>
                            <div
                                *ngIf="form.get('address')?.invalid && form.get('address')?.touched"
                                class="error-text" style="color: red;">
                                Address is required.
                            </div>
                        </div>
                        <div class="form-css-inline">
                            <div class="form-css-half">
                                <label for="city">
                                    City <span *ngIf="form.get('city')?.errors && form.get('city')?.touched"
                                        style="color: red;">*</span>
                                </label>
                                <app-input formControlName="city" name="city"
                                    type="text" [required]="true"
                                    [ngClass]="{'invalid-field': form.get('city')?.invalid && form.get('city')?.touched}"></app-input>
                                <div
                                    *ngIf="form.get('city')?.invalid && form.get('city')?.touched"
                                    class="error-text" style="color: red;">
                                    City is required.
                                </div>
                            </div>
                            <div class="form-css-half">
                                <label for="state">
                                    State <span *ngIf="form.get('state')?.errors && form.get('state')?.touched"
                                        style="color: red;">*</span>
                                </label>
                                <app-input formControlName="state" name="state"
                                    type="text" [required]="true"
                                    [ngClass]="{'invalid-field': form.get('state')?.invalid && form.get('state')?.touched}"></app-input>
                                <div
                                    *ngIf="form.get('state')?.invalid && form.get('state')?.touched"
                                    class="error-text" style="color: red;">
                                    State is required.
                                </div>
                            </div>
                        </div>
                        <div class="form-css">
                            <label for="postalCode">
                                Postal Code <span *ngIf="form.get('postalCode')?.errors && form.get('postalCode')?.touched"
                                    style="color: red;">*</span>
                            </label>
                            <app-input formControlName="postalCode"
                                name="postalCode" type="text" [required]="true"
                                [ngClass]="{'invalid-field': form.get('postalCode')?.invalid && form.get('postalCode')?.touched}"></app-input>
                            <div
                                *ngIf="form.get('postalCode')?.invalid && form.get('postalCode')?.touched"
                                class="error-text" style="color: red;">
                                Valid postal code is required.
                            </div>
                        </div>
                    </div>
                    </div>
                 <div class="section section-three">
                    <h3>Additional Information</h3>
                    <div class="form-css">
                        <label for="chooseoption">
                            Choose Option <span
                                *ngIf="form.get('selectedValue')?.errors && form.get('selectedValue')?.touched"
                                style="color: red;">*</span>
                        </label>
                        <app-dropdown
                            formControlName="selectedValue"
                            name="genericDropdown"
                            [options]="dropdownOptions"
                            [required]="true"
                            (valueChange)="handleValueChange($event)"
                            [ngClass]="{'invalid-field': form.get('selectedValue')?.invalid && form.get('selectedValue')?.touched}"></app-dropdown>
                        <div
                            *ngIf="form.get('selectedValue')?.invalid && form.get('selectedValue')?.touched"
                            class="error-text" style="color: red;">
                            Selection is required
                        </div>
                    </div>
                    <div class="form-css">
                        <label for="chooseoption">
                            Fees Procssing
                             <span
                                *ngIf="form.get('selectedfees')?.errors && form.get('selectedfees')?.touched"
                                style="color: red;">*</span>
                        </label>
                        <app-dropdown
                            formControlName="selectedfees"
                            name="feesprocess"
                            [options]="feesprocess"
                            [required]="true"
                            (valueChange)="handlefeesprocessing($event)"
                            [ngClass]="{'invalid-field': form.get('selectedfees')?.invalid && form.get('selectedfees')?.touched}"></app-dropdown>
                        <div
                            *ngIf="form.get('selectedfees')?.invalid && form.get('selectedfees')?.touched"
                            class="error-text" style="color: red;">
                            Selection is required
                        </div>
                    </div>
                    <div class="form-css">
                        <label for="age">
                            Age <span *ngIf="form.get('age')?.errors && form.get('age')?.touched"
                                style="color: red;">*</span>
                        </label>
                        <app-input formControlName="age" name="age"
                            [required]="true" type="number" [min]="18"
                            [max]="100"
                            [ngClass]="{'invalid-field': form.get('age')?.invalid && form.get('age')?.touched}"></app-input>
                        <div *ngIf="form.get('age')?.invalid && form.get('age')?.touched"
                            class="error-text" style="color: red;">
                            Age must be between 18 and 100.
                        </div>
                    </div>
                    </div>
                    <div class="form-button">
                        <p-button class="btn1" label="Discard"
                            [class]="'p-button-danger mr-2'"
                            (onClick)="ResetForm()"></p-button>
                        <button pButton class="btn2" label="Submit" [style]="{'background-color':'red','color':'white'}"
                            type="submit"></button>
                    </div>
                </div>
            </form>
        </ng-template>

        <ng-template pTemplate>
            <div class="pdf-preview">
                <div class="pdf-header">
                    <i class="pi pi-file-pdf" aria-hidden="true"
                        style="font-size: 1.5rem; margin-right: 8px; cursor: pointer;"
                        (click)="activeTab = 'pdf'; showBookInput = false;"></i>
                    <i class="pi pi-book" aria-hidden="true"
                        style="font-size: 1.5rem; margin-right: 8px; margin-left: 8px; cursor: pointer;"
                        (click)="activeTab = 'book'; showBookInput = true;"></i>
                    <span>Notes</span>
                </div>
                <ng-container *ngIf="activeTab === 'pdf'">
                    <div *ngIf="pdfUrls.length; else noPdfData">
                        <div *ngFor="let pdf of pdfUrls; let i = index"
                            class="pdf-card"
                            [ngClass]="{ 'recent-pdf': mostRecentType === 'pdf' && mostRecentIndex === i }"
                            (click)="openPdf(i)">
                            <div class="card-content">
                                <span class="pdf-label">
                                    Student Detail form Assigned by: {{ pdf.name  }}
                                </span>
                            </div>
                            <div class="pdf-icon">
                                <i class="pi pi-user" aria-hidden="true"></i>
                                <time [attr.datetime]="pdf.submissionTime">
                                    Submitted on: {{ pdf.submissionTime }}
                                </time>
                            </div>
                        </div>
                    </div>
                    <ng-template #noPdfData>
                        <div class="no-data-message"
                            style="color: #888; margin-bottom: 10px;">No PDF
                            data</div>
                    </ng-template>
                    <div *ngIf="uploadedFiles.length">
                        <div class="pdf-card"
                            *ngFor="let file of uploadedFiles, let i = index"
                            [ngClass]="{ 'recent-pdf': mostRecentType === 'file' && mostRecentIndex === i }">
                            {{ file.name }} - {{ file.size }} bytes
                        </div>
                    </div>
                    <div class="footer">
                        <div class="card">
                            <p-toast />
                            <div class="card">
                                <p-fileUpload
                                    name="demo[]"
                                    url="https://www.primefaces.org/cdn/api/upload.php"
                                    (onUpload)="onUpload($event)"
                                    [multiple]="true"
                                    accept="image/*"
                                    [maxFileSize]="1000000"
                                    mode="advanced">
                                </p-fileUpload>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="activeTab === 'book'">
                    <div *ngIf="bookValues.length; else noBookData">
                        <div class="book-value-list"
                            style="margin-bottom: 10px;">
                            <div class="pdf-card"
                                *ngFor="let value of bookValues; let i = index">
                                <span class="book-value"
                                    style="display: block; margin-bottom: 2px; color:white">{{
                                    value }}</span>
                                <span class="submission-time"
                                    style="font-size: 13px; color: #888;">Submitted
                                    on: {{ bookTimes[i] }}</span>
                            </div>
                        </div>
                    </div>
                    <ng-template #noBookData>
                        <div class="no-data-message"
                            style="color: #888; margin-bottom: 10px;">No book data</div>
                    </ng-template>
                    <div *ngIf="showBookInput" class="footer"
                        style="margin-bottom: 1rem;">
                        <input type="text" pInputText
                            [(ngModel)]="bookInputValue"
                            placeholder="Enter book info..."
                            style="margin-right: 8px; width: 25vw; " />
                        <button pButton type="button" label="Save"
                            (click)="saveBookInput()"
                            style="margin-right: 4px;"></button>
                        <button pButton type="button" label="Cancel"
                            class="p-button-secondary"
                            (click)="cancelBookInput()"></button>
                    </div>
                </ng-container>
            </div>
        </ng-template>
    </p-splitter>
</div>
